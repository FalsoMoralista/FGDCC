INFO:faiss.loader:Loading faiss with AVX2 support.
INFO:faiss.loader:Successfully loaded faiss with AVX2 support.
INFO:faiss.loader:Loading faiss with AVX2 support.
INFO:faiss.loader:Successfully loaded faiss with AVX2 support.
INFO:root:called-params configs/in1k_vith14_ep300_FGDCC.yaml
INFO:root:loaded params...
{   'data': {   'batch_size': 96,
                'color_jitter_strength': 0.0,
                'crop_scale': [0.3, 1.0],
                'crop_size': 224,
                'cutmix': 0.0,
                'drop_path': 0.25,
                'image_folder': '/home/rtcalumby/adam/luciano/plantnet_300K/',
                'mixup': 0.0,
                'nb_classes': 1081,
                'num_workers': 8,
                'pin_mem': True,
                'reprob': 0.25,
                'resume_epoch': 0,
                'root_path': '/home/rtcalumby/adam/luciano/',
                'use_color_distortion': False,
                'use_gaussian_blur': False,
                'use_horizontal_flip': False},
    'logging': {   'folder': '/home/rtcalumby/adam/luciano/LifeCLEFPlant2022/logs/PlantNet300k_exp21',
                   'write_tag': 'jepa'},
    'mask': {   'allow_overlap': False,
                'aspect_ratio': [0.75, 1.5],
                'enc_mask_scale': [0.85, 1.0],
                'min_keep': 10,
                'num_enc_masks': 1,
                'num_pred_masks': 4,
                'patch_size': 14,
                'pred_mask_scale': [0.15, 0.2]},
    'meta': {   'copy_data': False,
                'load_checkpoint': True,
                'model_name': 'vit_huge',
                'pred_depth': 12,
                'pred_emb_dim': 384,
                'read_checkpoint': None,
                'use_bfloat16': True},
    'optimization': {   'ema': [0.9, 0.999],
                        'epochs': 50,
                        'final_lr': 3e-06,
                        'final_weight_decay': 0.4,
                        'ipe_scale': 1.0,
                        'label_smoothing': 0.1,
                        'lr': 0.0006,
                        'start_lr': 0.00015,
                        'warmup': 5,
                        'weight_decay': 0.05}}
INFO:root:Running... (rank: 0/1)
INFO:root:Initialized (rank/world-size) 0/1
INFO:root:MaskedAutoEncoder(
  (encoder): Sequential(
    (0): Linear(in_features=1024, out_features=768, bias=True)
    (1): GELU(approximate='none')
    (2): Linear(in_features=768, out_features=512, bias=True)
    (3): GELU(approximate='none')
    (4): Linear(in_features=512, out_features=384, bias=True)
    (5): GELU(approximate='none')
  )
  (decoder): Sequential(
    (0): Linear(in_features=384, out_features=512, bias=True)
    (1): GELU(approximate='none')
    (2): Linear(in_features=512, out_features=768, bias=True)
    (3): GELU(approximate='none')
    (4): Linear(in_features=768, out_features=1024, bias=True)
  )
)
INFO:root:making imagenet data transforms
INFO:root:making imagenet data transforms
INFO:root:Finetuning dataset created
Training dataset, length: 245952
INFO:root:Finetuning dataset created
Val dataset, length: 31200
INFO:root:Using AdamW
['encoder', 'predictor', 'opt', 'scaler', 'target_encoder', 'epoch', 'loss', 'batch_size', 'world_size', 'lr']
INFO:root:loaded pretrained encoder from epoch 66 with msg: <All keys matched successfully>
INFO:root:Using AdamW
INFO:root:VisionTransformer(
  (patch_embed): PatchEmbed(
    (proj): Conv2d(3, 1280, kernel_size=(14, 14), stride=(14, 14))
  )
  (blocks): ModuleList(
    (0-31): 32 x Block(
      (norm1): LayerNorm((1280,), eps=1e-06, elementwise_affine=True)
      (attn): Attention(
        (qkv): Linear(in_features=1280, out_features=3840, bias=True)
        (attn_drop): Dropout(p=0.0, inplace=False)
        (proj): Linear(in_features=1280, out_features=1280, bias=True)
        (proj_drop): Dropout(p=0.0, inplace=False)
      )
      (drop_path): Identity()
      (norm2): LayerNorm((1280,), eps=1e-06, elementwise_affine=True)
      (mlp): MLP(
        (fc1): Linear(in_features=1280, out_features=5120, bias=True)
        (act): GELU(approximate='none')
        (fc2): Linear(in_features=5120, out_features=1280, bias=True)
        (drop): Dropout(p=0.0, inplace=False)
      )
    )
  )
  (norm): LayerNorm((1280,), eps=1e-06, elementwise_affine=True)
)
INFO:root:Building cache...
INFO:root:Done.
INFO:root:Initializing centroids...
Centroids for class 573 K= 2 [[-0.12615836 -0.31230396 -0.02526665 -0.64791983 -0.27544576 -1.178246
  -0.31261787 -0.49945784 -0.24517365  0.38441816 -0.33492997  0.01604305
  -0.2178744  -0.2421057   1.3790425   0.31193537 -0.99898285  0.70846975
  -0.37967724  1.1274033  -0.32438806  0.29470402 -0.0888085  -0.5499709
  -0.07878577 -0.46217516 -0.77886087 -0.01167974  0.4121948  -0.6920699
   0.49029246 -0.31039432  0.87211734  0.8853569  -1.0089928   0.31021854
   0.9446486  -0.6726123   1.8354384   0.36167055 -0.21318257  0.6560021
  -0.11678692 -1.7000198   0.6940872  -0.7468228   0.9776745  -0.40704954
  -0.5033851  -0.29125115  1.3427618  -0.53402054  0.21781671  0.27255312
  -0.91403383 -0.02855059 -1.1570529   0.18428485  0.40461856  0.15603755
  -0.1597098   0.49941996 -1.4680595  -1.1601437   1.1253457   0.05060442
  -0.8666439  -0.79661524  0.09182477 -0.6044923   0.27557352 -0.9696181
  -0.42067996 -0.08987866 -0.1426305   0.5743782   0.3531134   0.0995371
  -0.40653604  0.09125523 -0.13525133  0.4388899  -0.51942885  0.05073791
   0.5585129  -0.3225365   0.6564149  -0.86734813 -0.17587912 -0.7209841
  -0.3843397   0.31808215 -0.29178393  0.21154809  0.17459805 -0.48757547
   0.1888537   0.05149939  0.1911213   0.296594    0.04816585 -0.01038603
   0.19675928 -0.65970737  0.42953703  0.01860243  0.18309565 -0.22624055
   0.40014297 -0.49137017  0.27762464 -0.2464458   0.08413628  0.79819953
  -0.3053118  -0.06908238 -0.86273944  0.79960096 -0.05590172 -0.48972553
   1.1471648  -0.873919    0.6229896   1.5064751   0.5985855  -0.43928245
  -0.27735963 -0.45796716  0.07327596  0.24524081 -0.357523   -0.3316178
  -1.2451226  -1.0664386  -0.5318148  -0.24168341 -0.69449294  0.6937218
  -0.16386974  0.42672816 -1.1953188   0.70563126 -0.5217168   1.5331308
  -0.05194119 -0.45614243 -0.39276525 -0.53959733  0.06514489  0.57897764
  -0.2568357  -0.14141075  0.68133044  0.12603489  0.20599774  0.8610175
   0.06267846 -0.6521829  -0.7176087   0.55385995 -0.5398     -0.96510416
   0.4261759  -0.93418944  0.09198282 -0.4364819   0.50320446  0.18913017
   0.29390293  0.9772397   0.07836165 -0.12953104 -1.2789222  -0.27665535
  -0.268072    0.2022671   0.28873187 -0.10982013 -0.23815973 -1.0868858
  -0.8691767  -1.0568142   0.28140253  0.75667477 -0.01145793  0.84358364
   0.34971133 -0.10192201  0.0605244  -0.4015948  -0.10237727 -0.06834386
  -0.32004923  0.31991085  0.25980023 -0.65482205  0.20976712 -0.24312313
   1.0009248   0.81438893  0.43844673  0.5642715  -0.18452646 -0.3350402
   0.07082318 -0.1063663   0.47654933 -0.14791273 -0.21413395 -0.00383344
  -0.6564316   0.06679557 -0.36266217  0.146656   -0.2022166   0.5460966
  -0.30298942  0.36882684  0.64784986 -0.30005595 -0.06355218  0.3842924
  -0.8591187   0.2745014   0.24807654  0.258781    0.02443426  0.44601855
   0.09600677  0.00519547  0.08383509 -0.03128145  0.3078809   0.27595058
   1.0434573   0.02017693 -0.3503494  -0.15568863  1.3431365   0.6876567
   0.6212822  -1.0787418  -0.13456571  1.0734118  -0.29079616 -0.81664515
  -0.36949444 -0.8213413   0.506918   -0.32721993  0.529183    0.1895953
   0.64863276 -0.8077348  -0.36555734  0.2113017   1.1490868   1.4526995
   0.09485164 -0.0383382  -0.7029665  -1.5491979   0.0575493  -0.34075877
   0.28338224 -0.22472163  0.07523842  1.4139212  -0.1513384   0.5372765
  -0.8934398   0.15697753  0.62518984 -0.2204105  -0.48453012 -0.7232635
   1.0904977  -0.73275596  0.20056316 -0.21122625 -0.20036666  0.99162734
   0.13052693 -1.197737    0.9032963  -0.05838105  0.13304296  0.3567573
   1.2893711   1.0105131  -0.18118465 -0.23267822  1.283763    0.04211421
  -0.4786235  -0.25354427 -0.44663814 -0.46741268 -0.9838855  -0.645522
   0.13888356  0.22697477 -0.20555092  0.8090367  -0.71980137 -0.51518
  -0.80999994 -0.6278638   0.92985684 -0.26655167 -0.3549028   1.2551035
   0.18771546 -0.06879117  0.26521564 -0.29672217  0.1428244   0.3345335
   0.5031144  -0.83505386  1.3303437  -1.4550494  -0.00462241 -0.26153532
   0.17140406  0.26577973  1.8892643  -0.28004533  0.8278937  -0.01183977
   0.96687794  0.05314254  0.14727345  0.577451   -0.99946445  0.33255473
  -0.4430459  -0.34827396  0.84061277  0.324111   -0.08694178  0.44795105
   0.09549902  0.13573097 -1.1601537  -0.16475914 -0.43188095  1.3235253
   0.02168649  0.19206902 -1.1900718   0.82868123 -0.68789214  0.44595656
   0.02155232  0.35641223  0.3029537   0.1721102  -0.13784853 -0.05636211
  -0.11531766 -0.17127748 -0.6844413  -0.08380493  0.01183526  0.05192442
   0.07570003 -0.58976907  0.6218849  -0.20606814  1.1340243   0.31815615
  -0.5303492   0.26014838  0.42751518 -0.65094274  0.21940978 -0.18954563
   0.27394795 -0.03528879 -0.04975909 -0.32094783  0.39261037  0.3041374 ]
 [ 0.27801278 -0.02891212  0.47447366 -0.71155024 -0.30829632 -1.2360973
  -0.04023921 -0.31326222 -0.01639764  0.23390186  0.42908663  0.11699144
  -0.48212266  0.09165333  1.0835216   0.46775794 -0.345623    0.48996523
  -0.38542283  0.7274244  -0.39604807 -0.20634565 -0.5579702  -0.5957662
   0.35016972 -0.62755376 -0.30509126  0.01462955  0.7935831  -0.35958233
   0.44543284  0.03333519  1.0304792   0.8851341  -0.4528116   0.47245097
   0.60304487 -0.90602505  1.5257381  -0.02961618  0.4908274   0.5104159
  -0.31738287 -1.5342345   0.65355647 -0.5811138   0.05341046  0.16039044
   0.08573341 -0.2629012   0.89183575 -0.37351424  0.23512262 -0.05413124
  -0.73799956 -0.04414606 -1.0757177   0.6366823   0.36212397 -0.0640754
  -0.863014    0.24548425 -1.455061   -0.6667151   0.74705994 -0.12294671
  -0.04861252  0.02724029  0.6802659  -0.62675333  0.5919038  -0.8520151
   0.09007729  0.2062595  -0.09218688  0.7659248  -0.19521675 -0.2377082
  -0.19929327 -0.56212133 -0.32196912 -0.0158828  -0.6410704   0.31506163
   0.08326394 -0.51910114  0.29894683 -0.49796408  0.20311315 -0.28145054
  -0.00708612  0.26980004 -0.11058861  0.15132971 -0.41903228 -0.7154912
  -0.32601133  0.23006107  0.27959335 -0.05841233  0.25983956  0.21590106
   0.42090303 -0.14343204  0.50504994  0.01717658  0.55878943 -0.37997872
   1.0748609  -0.15421598 -0.10252515 -0.14215808  0.7193974   0.9159137
  -0.35859102 -0.23417695 -1.4334248   0.5475268  -0.00440976 -0.6583764
   0.359077   -0.5835983   0.76557785  1.3725722  -0.41594237 -0.2850084
  -0.5094285  -0.8988056   0.60643077 -0.68050224 -0.4271498   0.19040461
  -0.39037266 -0.98585165 -0.21773079  0.09417415  0.08118732  0.3158236
   0.22436708  0.99792284 -0.5451882   0.05801088 -0.0273083   1.0248082
  -0.09287261 -0.32484278 -0.09485119 -0.04191152  0.30418828  0.4157055
  -0.08329261  0.17348166  0.68347925  0.9269487   0.04999602  1.3061608
   0.20752797 -1.7268639  -0.3543744   0.33075035  0.19451258 -0.5769182
   0.5203767  -0.34831002  0.19206657 -0.42856333  0.17164145  0.12938556
   0.48092425  0.73291934  0.5700044  -0.25076202 -0.61559707 -0.43861753
   0.2948634  -0.13648881  0.16729297 -0.48963034  0.05101484 -0.7302526
  -1.167293   -0.77510285  0.5074215   0.23311101  0.36334684  0.38807467
   0.4771768   0.25408676  0.02430231 -0.45288116 -0.09259754 -0.09110752
   0.6762848   0.5016553  -0.18643294 -0.5641366   0.69538033 -0.2841013
   0.8416686   0.2133939   0.39329514 -0.1797821  -0.3714771  -0.6404053
  -0.42238128  0.27117008  0.35870206  0.11483987  0.02103788  0.09152319
  -0.42187926 -0.61733    -1.0082557  -0.13339601 -0.37701675 -0.34002152
   0.17894097 -0.88137275  0.5835181  -0.0826804  -0.8135026   0.08923835
  -0.5243355   0.18291579  0.03847695  0.23198573 -0.14409277  0.33417934
   0.1636493   0.03232163 -0.08491451 -0.14244175 -0.60371095  0.90138704
   0.5847265  -0.07128276  0.14435548 -0.32156402  1.305251    1.071209
   0.21307346 -1.0578562   0.1173977   0.37053946 -0.25616613 -1.3686297
  -0.51955193 -0.7592539   0.00450349 -0.10440771  0.7172704   0.02943166
   0.5056807  -0.8477066   0.16512737  0.38437453  1.381184    0.844377
  -0.63047045  0.00795299 -0.69100875 -1.62615     0.22528195  0.20655788
  -0.36991537 -0.43040717  0.28321996  1.2815374   0.16325903 -0.35957396
  -0.20701613  0.06612349  0.20584774  0.0484807  -0.39345253 -0.6933518
   1.3740542  -0.5906869   0.19222318  0.24510117  0.0532226   1.0022335
   0.4771724  -0.7161267   0.8875357   0.3997425  -0.22908641  0.0359228
   1.1313732   0.35695556 -0.15074438 -0.08482707  0.62310094  0.5710478
  -0.37502545 -0.08344009 -0.55016357 -0.5101333  -0.8573872  -0.5130825
   0.13747038  0.5561251  -0.7417139   0.5885424  -0.6166481  -0.70468134
  -0.29748237 -0.58802325  0.2677894  -0.6400673   0.05891722  1.0454181
   0.06285961  0.03311575  0.19637585 -0.35578755 -0.3411752  -0.18306565
   0.1728644  -0.2966148   1.1306494  -1.3444915  -0.56439734 -0.31734234
   0.66080517  0.00473648  1.4815755  -0.7071094   0.19972286 -0.6610514
   0.9534278   0.03750248  0.28080156  0.19106953 -1.0264634   0.56660396
  -0.60936743 -0.16046128  0.2177454   0.68461156  0.17926757  0.2409826
  -0.36345196  0.29133454 -0.7894713   0.71390927  0.10833991  1.7604831
  -0.4553521  -0.02615835 -1.8449765   1.5957955  -0.8605637   0.29514074
  -0.30103436  0.83637416  0.29766333  0.30987287 -0.4637386   0.0851652
  -0.32813722 -0.8446916  -0.01280144 -0.31640863 -0.19491015 -0.04278441
  -0.19976202 -0.24039635  0.52526456  0.48983672  0.85235393  0.4977482
  -0.21451129  0.6780003  -0.16971189 -1.2618992   0.0303064  -0.30314887
  -0.09071923  0.24860944  0.10116054 -0.00568707 -0.20153077  0.4097879 ]]
length: 2
size: torch.Size([384])
Centroids for class 573 K= 3 [[ 0.08893262 -0.22474222  0.2547172  ... -0.04621665  0.0011693
   0.36785245]
 [ 0.6012361   0.08390549  0.42213988 ...  0.08051047 -0.38627374
   0.30784434]
 [ 0.4445266   0.2515611   0.7744817  ... -0.04653498 -0.41139877
   0.49215546]]
length: 3
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
Centroids for class 573 K= 4 [[ 0.16004314  0.06721509  0.30342174 ...  0.11914189 -0.2634153
   0.41901168]
 [-0.00086054 -0.51548576  0.36032745 ... -0.2816517   0.36990663
   0.38173294]
 [ 0.65594655  0.2196292   0.6619811  ...  0.02175183 -0.6142699
   0.35843304]
 [ 0.12608118 -0.16263263  0.3021131  ... -0.30317333  0.8129483
   0.38675448]]
length: 4
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
Centroids for class 573 K= 5 [[ 8.7936424e-02  5.4541218e-01  1.7371650e-01 ...  8.1450827e-02
  -2.9072940e-01  5.1879007e-01]
 [-9.3748480e-02 -4.2157799e-01  3.4393284e-01 ... -4.6029308e-01
   5.0863719e-01  3.0479053e-01]
 [ 7.0073485e-01  2.6324588e-01  6.4792317e-01 ... -6.0235092e-04
  -7.0948827e-01  3.2510629e-01]
 [ 8.2662173e-02 -1.5521258e-01  2.9918861e-01 ... -3.3162722e-01
   8.3284223e-01  4.1276073e-01]
 [ 2.0642713e-01 -2.9500556e-01  4.2055154e-01 ...  5.6508165e-02
  -9.7796641e-02  4.0395036e-01]]
length: 5
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
size: torch.Size([384])
Exitting
